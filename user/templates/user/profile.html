{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<div class="profile-page">
  <!-- Left column: profile info and form -->
  <div class="profile-content">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="avatar-section">
        {% if user.avatar %}
          <img src="{{ user.avatar.url }}" alt="Avatar" class="avatar">
        {% else %}
          <img src="{% static 'images/default-avatar.png' %}" alt="Avatar" class="avatar">
        {% endif %}
      </div>
      <div class="user-info">
        <h2>{{ user.full_name }}</h2>
        <p>{{ user.email }}</p>
      </div>
    </div>

    <!-- Profile Form -->
    <form method="POST" enctype="multipart/form-data" class="profile-form" id="profileForm">
      {% csrf_token %}
      {% for field in form %}
        <div class="form-group" style="display: flex; align-items: center;">
          <label for="{{ field.id_for_label }}" style="flex: 1;">{{ field.label }}</label>
          
          {% if field.name == "avatar" %}
            {{ field.as_widget(attrs={'disabled': 'disabled', 'id': field.auto_id}) }}
          {% else %}
            {{ field.as_widget(attrs={'disabled': 'disabled', 'id': field.auto_id}) }}
          {% endif %}
          
          <button type="button" class="edit-btn" data-field-id="{{ field.auto_id }}" style="margin-left: 10px;">
            Edit
          </button>
          {{ field.errors }}
        </div>
      {% endfor %}
      <button type="submit" class="btn-submit" id="saveBtn" style="display:none; margin-top: 20px;">Save Changes</button>
    </form>

    <!-- Bottom Actions -->
    <div class="bottom-actions" style="margin-top: 20px;">
      <a href="{% url 'update-password' %}" class="password-link">Update Password</a>
    </div>
  </div>

  <!-- Right column: request post banner -->
  <div class="request-post-section">
    <div class="request-post-banner">
      <div class="banner-overlay">
        <h2 class="banner-title">Request a Post</h2>
        <a href="#" class="btn-request-post">Request a Post</a>
      </div>
    </div>
  </div>
</div>

<script>
  // Wait for DOM to load
  document.addEventListener('DOMContentLoaded', () => {
    const editButtons = document.querySelectorAll('.edit-btn');
    const saveBtn = document.getElementById('saveBtn');

    editButtons.forEach(button => {
      button.addEventListener('click', () => {
        const fieldId = button.getAttribute('data-field-id');
        const inputField = document.getElementById(fieldId);

        if (inputField) {
          // Enable the field for editing
          inputField.disabled = false;
          inputField.focus();

          // Show the Save Changes button
          saveBtn.style.display = 'block';

          // Optionally hide this edit button or disable it
          button.style.display = 'none';
        }
      });
    });
  });
</script>

{% endblock %}
